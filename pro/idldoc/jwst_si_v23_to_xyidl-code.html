<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.1 on Sun Mar 18 21:49:09 2018 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>jwst_si_v23_to_xyidl.pro (Documentation for /Users/penton/JWST/pro/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="jwst_si_v23_to_xyidl.pro (Documentation for /Users/penton/JWST/pro/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="jwst_si_v23_to_xyidl:source"></a>function jwst_si_v23_to_xyidl,v23,si,apername,verbose=verbose,debug=debug,$
	v2ref=v2ref,v3ref=v3ref,vIdlparity=VIdlparity
	if n_elements(debug) ne 1 then debug=0
	if n_elements(verbose) ne 1 then verbose=0
	rcs_id='$Id: jwst_si_v23_to_xyidl.pro,v 1.3 2018/03/15 12:12:22 penton Exp $'
	FF='(F12.6)'
	uSI=strupcase(strtrim(si,2))
	uAPER=strupcase(strtrim(apername,2))
	if verbose then message,/info,'Looking for SIAF info for '+uSI+' + '+uAPER
	dv2=double(reform(v23[0,*]))
	dv3=double(reform(v23[1,*]))

	siaf=jwst_read_si_siaf(si,verbose=(verbose > 1))
	index=where(siaf.APERNAME eq uAPER,count)
	v3IdlYAngle=(reform(siaf.V3IDLYANGLE[index]))[0]
	rv3IdlYAngle=(v3IdlYAngle)*!dtor
	VIDLPARITY=(reform(siaf.VIDLPARITY[index]))[0]
	if verbose then begin
		message,/info,'APERNAME  = '+uAPER
		message,/info,'[V2ref,V3ref] = ['+string1f(V2Ref,format=FF)+','+string1f(V3Ref,format=FF)+']'
		message,/info,'V3IDLYANGE = '+string1f(v3IdlYAngle,format=FF)
		message,/info,'VIDLPARITY = '+string1i(VIDLPARITY)
	endif
	V2Ref=(n_elements(V2ref) eq 1 ? V2Ref : reform(siaf.V2Ref[index]))
	V3Ref=(n_elements(V3ref) eq 1 ? V3Ref : reform(siaf.V3Ref[index]))

	xIdl = VIdlParity*(((dv2 - v2Ref)*cos(rv3IDLYAngle)) - ((dv3 - V3Ref)*sin(rv3IDLYAngle)))
	yIdl = (dv2 - V2Ref)*sin(rv3IDLYAngle) + (dv3 - V3Ref)*cos(rv3IDLYAngle)
	xy={xIdl:reform(xIDL),yIDL:reform(yIDL),xyIDL:[XIdl,YIdl],si:si,apername:apername,siaf:siaf,$
		VIDLPARITY:VIDLPARITY,v3IdlYAngle:v3IdlYAngle,rv3IdlYAngle:rv3IdlYAngle,v2:dv2,v3:dv3,$
		v2ref:v2ref,v3ref:v3ref}
	if debug then help,xy,/str
	return,xy
end
</code>
    </div>
  </body>
</html>