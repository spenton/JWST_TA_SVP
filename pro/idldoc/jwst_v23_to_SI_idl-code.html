<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.1 on Sun Mar 18 21:49:10 2018 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>jwst_v23_to_SI_idl.pro (Documentation for /Users/penton/JWST/pro/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="jwst_v23_to_SI_idl.pro (Documentation for /Users/penton/JWST/pro/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="jwst_v23_to_SI_idl:source"></a>function jwst_v23_to_SI_idl,v23,SI=SI,APERTURE=APERTURE,out=out,v2ref=v2ref,v3ref=v3ref
	rcs_id="$Id"
	if n_elements(SI) ne 1 then SI='NIRISS' <span class="comments">; We'll improve this later</span>
	if n_elements(APERTURE) ne 1 then APERTURE='NIRISS_TA'
	<span class="comments">;</span>
	<span class="comments">;Convert v2, v3 to SI Ideal</span>
	<span class="comments">;Convert the destination v2, v3 coordinates into SI Ideal coordinates (xIdl and yIdl).</span>
	<span class="comments">;</span>
	<span class="comments">; V23  = [v2,v3] in arcseconds</span>
	<span class="comments">;</span>
	<span class="comments">; Output is SI Idl (IDL), also in arcseconds</span>
	<span class="comments">;</span>
	<span class="comments">; This is equations 41 & 42 in JWST-STScI-003289</span>
	<span class="comments">; eqn 41	xIdl = (VIdlParity)((v2rcos(rV3IdlYAngle)) Ð (v3rsin(rV3IdlYAngle)))</span>
	<span class="comments">; eqn 42	yIdl = v2rsin(rV3IdlYAngle) + v3rcos(rV3IdlYAngle)</span>

	<span class="comments">;</span>
	<span class="comments">; Step 1:</span>
	<span class="comments">; 	Get the V3IdlYAngle from the SIAF file, and convert to radians</span>
	<span class="comments">;</span>
	si_info=jwst_get_si_info_from_siaf(SI)
	index=where(si_info.apername eq 'APERTURE')

	V3IdlYangle=si_info.V3IdlYangle[index]
	rV3IdlYangle=V3IdlYangle*!dtor
	<span class="comments">;</span>
	<span class="comments">; Step 2:</span>
	<span class="comments">;	Get VIdlParity from the siaf</span>
	VIdlParity=si_info.VIdlParity[index]
	<span class="comments">;</span>
	<span class="comments">; Step 3:</span>
	<span class="comments">;	Get [Xref,Yref]</span>
	<span class="comments">;</span>
	v2ref=si_info.v2ref[index]
	v3ref=si_info.v3ref[index]
	v2r=(v2-v2Ref)
	v3r=(v3-v3Ref)
	<span class="comments">;</span>
	<span class="comments">; Step 4</span>
	<span class="comments">;	Get Xidl,Yidl</span>
	<span class="comments">;</span>
	xIdl = (VIdlParity) * ((v2r * cos(rV3IdlYAngle)) Ð (v3r * sin(rV3IdlYAngle)))
	yIdl = v2r *sin(rV3IdlYAngle) + v3r *cos(rV3IdlYAngle)
	if verbose then begin
		message,/info,'[V2ref,V3ref]='+string1f(V2Ref,format=FF)+','+string1f(V3Ref,format=FF)+']'
		message,/info,'V3IDLYANGE = '+string1f(v3IdlYAngle,format=FF)'
		message,/info,'VIDLPARITY = '+string1i(VIDLPARITY)
	endif

	xy=[xIDL,yIDL]
	out=(VIdlParity:VIdlParity,V3IdlYangle:V3IdlYangle,rV3IdlYangle:rV3IdlYangle,$
		v2ref:v2ref,v3ref:v3ref,xIdl:xIdl,yIdl:yIdl,xy:xy,SI:SI,APERTURE:APERTURE,$
		si_info:si_info)

	return,xy

end


</code>
    </div>
  </body>
</html>